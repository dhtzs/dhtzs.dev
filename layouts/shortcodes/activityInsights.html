<div>
    <div class="insights-widget-container">
        <div class="insights-widget-icon">
            <a href="/" target="_blank" aria-label="song thumbnail">
                <img src="data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt="song thumbnail" aria-label="song thumbnail">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
                </svg>
            </a>
        </div>
        <div class="insights-widget-content">
            <a href="/" target="_blank">No music playing</a>
            <p>&mdash;</p>
        </div>
    </div>
    <div class="insights-widget-container">
        <div class="insights-widget-icon">
            <a href="/" target="_blank" aria-label="program thumbnail">
                <img src="data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt="program thumbnail" aria-label="program thumbnail">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
            </a>
        </div>
        <div class="insights-widget-content">
            <a href="/" target="_blank">No program running</a>
            <p>&mdash;</p>
        </div>
    </div>
</div>
<script>
    var widgetContent = document.querySelectorAll(".insights-widget-content a, .insights-widget-content p"),
        spotify_data_track_id;
    setInterval((function _() {
        fetch("https://dhtzs.dev/api/activity?type=insights").then(function(res) {
            return res.json();
        }).then(function(data) {
            var spotify_data = data.spotify;
            if (data.listening_to_spotify) {
                if (spotify_data_track_id != spotify_data.track_id) {
                    widgetContent[0].innerHTML = spotify_data.song;
                    widgetContent[0].href = `https://open.spotify.com/track/${spotify_data.track_id}`;
                    widgetContent[0].style.pointerEvents = "auto";
                    widgetContent[1].innerHTML = spotify_data.artist.replaceAll(";", ",");
                    document.querySelectorAll(".insights-widget-icon img")[0].src = spotify_data.album_art_url;
                    document.querySelectorAll(".insights-widget-icon img")[0].style.display = "block";
                    document.querySelectorAll(".insights-widget-icon svg")[0].style.display = "none";
                    document.querySelectorAll(".insights-widget-icon a")[0].href = `https://open.spotify.com/track/${spotify_data.track_id}`;
                    document.querySelectorAll(".insights-widget-icon a")[0].style.pointerEvents = "auto";
                    spotify_data_track_id = spotify_data.track_id;
                }
            } else {
                widgetContent[0].innerHTML = "No music playing";
                widgetContent[0].href = "/"
                widgetContent[0].style.pointerEvents = "none";
                widgetContent[1].innerHTML = "&mdash;";
                document.querySelectorAll(".insights-widget-icon img")[0].src = "data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";
                document.querySelectorAll(".insights-widget-icon img")[0].style.display = "none";
                document.querySelectorAll(".insights-widget-icon svg")[0].style.display = "block";
                document.querySelectorAll(".insights-widget-icon a")[0].href = "/";
                document.querySelectorAll(".insights-widget-icon a")[0].style.pointerEvents = "none";
            }

            var activities_data = data.activities.filter(function(activity) {
                return activity.name != "Spotify";
            });
            if (activities_data.length > 0) {
                widgetContent[2].innerHTML = `${["Playing", "Streaming on", "Listening to", "Watching", "Running", "Competing in"][activities_data[0].type]} ${activities_data[0].name}`;
                widgetContent[3].innerHTML = activities_data[0].details || "&mdash;";
                if (activities_data[0].assets) {
                    document.querySelectorAll(".insights-widget-icon img")[1].src =
                        activities_data[0].assets.large_image?.startsWith("twitch:")
                            ? `https://static-cdn.jtvnw.net/previews-ttv/live_user_${activities_data[0].assets.large_image.split(":")[1]}-640x640.jpg`
                            : `https://cdn.discordapp.com/app-assets/${activities_data[0].application_id}/${activities_data[0].assets.small_image ?? activities_data[0].assets.large_image}.png`;
                    document.querySelectorAll(".insights-widget-icon img")[1].style.display = "block";
                    document.querySelectorAll(".insights-widget-icon svg")[1].style.display = "none";
                }
                if (activities_data[0].url) {
                    widgetContent[2].href = activities_data[0].url;
                    widgetContent[2].style.pointerEvents = "auto";
                    document.querySelectorAll(".insights-widget-icon a")[1].href = activities_data[0].url;
                    document.querySelectorAll(".insights-widget-icon a")[1].style.pointerEvents = "auto";
                } else {
                    widgetContent[2].href = "/";
                    widgetContent[2].style.pointerEvents = "none";
                    document.querySelectorAll(".insights-widget-icon a")[1].href = "/";
                    document.querySelectorAll(".insights-widget-icon a")[1].style.pointerEvents = "none";
                }
            } else {
                widgetContent[2].innerHTML = "No program running";
                widgetContent[2].href = "/";
                widgetContent[2].style.pointerEvents = "none";
                widgetContent[3].innerHTML = "&mdash;";
                document.querySelectorAll(".insights-widget-icon img")[1].src = "data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";
                document.querySelectorAll(".insights-widget-icon img")[1].style.display = "none";
                document.querySelectorAll(".insights-widget-icon svg")[1].style.display = "block";
                document.querySelectorAll(".insights-widget-icon a")[1].href = "/";
                document.querySelectorAll(".insights-widget-icon a")[1].style.pointerEvents = "none";
            }
        });
        return _;
    })(), 15000);
</script>
