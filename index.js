var H=Object.defineProperty;var f=(t,n)=>H(t,"name",{value:n,configurable:!0});async function N(t){let n=(new URL(t.request.url).searchParams.get("type")||"").toLowerCase().trim();if(n=="insights"){let e=new Headers({"User-Agent":"CloudflareWorker/1.0"});try{let r=await fetch("https://api.lanyard.rest/v1/users/685173086022402060",{method:"GET",headers:e});return r.ok?(r=await r.json(),r.success?(r=Object.fromEntries(Object.entries(r.data).filter(([o])=>!["kv","discord_user","discord_status","active_on_discord_desktop","active_on_discord_mobile","active_on_discord_web"].includes(o))),new Response(JSON.stringify(r),{headers:{"Content-Type":"application/json"}})):(console.error("Error fetching data from API"),new Response("Error fetching data from API",{status:400}))):(console.error(`Error fetching data from API: ${r.status} ${r.statusText}`),new Response("Error fetching data from API",{status:500}))}catch(r){return console.error(r.message),new Response(`Error: ${r.message}`,{status:500})}}else if(n=="interactions"){let e=new Headers({"User-Agent":"CloudflareWorker/1.0"});try{let r=await fetch(`https://api.github.com/gists/${t.env.GIST_ID}`,{method:"GET",headers:e});return r.ok?(r=await r.json(),!r.files||!r.files["activity.log"]?(console.error("Error fetching data from API"),new Response("Error fetching data from API",{status:400})):new Response(r.files["activity.log"].content,{headers:{"Content-Type":"application/json"}})):(console.error(`Error fetching data from API: ${r.status} ${r.statusText}`),new Response("Error fetching data from API",{status:500}))}catch(r){return console.error(r.message),new Response(`Error: ${r.message}`,{status:500})}}else if(n=="reports"){let e=(new URL(t.request.url).searchParams.get("platform")||"").toLowerCase().trim(),r=Math.abs(parseInt(new URL(t.request.url).searchParams.get("max")))||Number.MAX_SAFE_INTEGER;if(e=="hackerone"){let o=new Headers({"User-Agent":"CloudflareWorker/1.0",Authorization:"Basic "+btoa("dhtzs:"+t.env.HACKERONE_API_KEY),Accept:"application/json"}),a=[],i=100,c=1;for(;a.length<r;)try{let s=await fetch(`https://api.hackerone.com/v1/hackers/me/reports?page[size]=${i}&page[number]=${c}`,{method:"GET",headers:o});if(!s.ok)return console.error(`Error fetching data from API: ${s.status} ${s.statusText}`),new Response("Error fetching data from API",{status:500});if(s=await s.json(),!s.data||!Array.isArray(s.data)||(a.push(...s.data.filter(p=>p.attributes.state=="resolved")),!s.links||!s.links.next))break;c++}catch(s){return console.error(s.message),new Response(`Error: ${s.message}`,{status:500})}return a=a.slice(0,r).map(s=>Object.fromEntries(Object.entries({bounty_awarded_at:s.attributes.bounty_awarded_at,closed_at:s.attributes.closed_at,created_at:s.attributes.created_at,disclosed_at:s.attributes.disclosed_at,rating:s.relationships.severity.data.attributes.rating,weakness:s.relationships.weakness.data.attributes.name}).filter(([,p])=>p!==null))),new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})}else return new Response(JSON.stringify({}),{headers:{"Content-Type":"application/json"},status:400})}else return new Response(JSON.stringify({}),{headers:{"Content-Type":"application/json"},status:400})}f(N,"onRequest");async function j(t){try{if(t.request.method!=="POST")return console.error("Error sending email: Method Not Allowed"),new Response("Error sending email: Method Not Allowed",{status:405});if(!(t.request.headers.get("Content-Type")||"").includes("application/x-www-form-urlencoded"))return console.error("Error sending email: Invalid Content-Type"),new Response("Error sending email: Invalid Content-Type",{status:400});let e=await t.request.formData();if(!e.get("email")||!e.get("message"))return console.error("Error sending email: Missing required fields"),new Response("Error sending email: Missing required fields",{status:400});let r=new FormData;r.append("secret",t.env.CF_SECRET_KEY),r.append("response",e.get("cf-turnstile-response")),r.append("remoteip",t.request.headers.get("CF-Connecting-IP"));let o=await fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify",{method:"POST",body:r});if(!o.ok)return console.error(`Error validating captcha: ${o.status} ${o.statusText}`),new Response("Error validating captcha",{status:500});if(o=await o.json(),!o.success)return console.error("Error validating captcha"),new Response("Error validating captcha",{status:400});let a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${t.env.RESEND_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({from:"dhtzs.dev <sender@dhtzs.dev>",to:"contact@dhtzs.dev",reply_to:e.get("email").trim(),cc:e.get("email").trim(),subject:"Encrypted message",text:"This email contains an encrypted file attachment, representing the message sent from dhtzs.dev. Decrypt the file to view its content.",attachments:[{content:btoa(e.get("message").trim()),filename:"message.enc"}]})});return a.ok?(a=await a.json(),new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})):(console.error(`Error sending email: ${a.status} ${a.statusText}`),new Response("Error sending email",{status:500}))}catch(n){return console.error(n.message),new Response(`Error: ${n.message}`,{status:500})}}f(j,"onRequest");var I=[{routePath:"/api/activity",mountPath:"/api",method:"",middlewares:[],modules:[N]},{routePath:"/api/email",mountPath:"/api",method:"",middlewares:[],modules:[j]}];function U(t){for(var n=[],e=0;e<t.length;){var r=t[e];if(r==="*"||r==="+"||r==="?"){n.push({type:"MODIFIER",index:e,value:t[e++]});continue}if(r==="\\"){n.push({type:"ESCAPED_CHAR",index:e++,value:t[e++]});continue}if(r==="{"){n.push({type:"OPEN",index:e,value:t[e++]});continue}if(r==="}"){n.push({type:"CLOSE",index:e,value:t[e++]});continue}if(r===":"){for(var o="",a=e+1;a<t.length;){var i=t.charCodeAt(a);if(i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||i===95){o+=t[a++];continue}break}if(!o)throw new TypeError("Missing parameter name at ".concat(e));n.push({type:"NAME",index:e,value:o}),e=a;continue}if(r==="("){var c=1,s="",a=e+1;if(t[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<t.length;){if(t[a]==="\\"){s+=t[a++]+t[a++];continue}if(t[a]===")"){if(c--,c===0){a++;break}}else if(t[a]==="("&&(c++,t[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));s+=t[a++]}if(c)throw new TypeError("Unbalanced pattern at ".concat(e));if(!s)throw new TypeError("Missing pattern at ".concat(e));n.push({type:"PATTERN",index:e,value:s}),e=a;continue}n.push({type:"CHAR",index:e,value:t[e++]})}return n.push({type:"END",index:e,value:""}),n}f(U,"lexer");function z(t,n){n===void 0&&(n={});for(var e=U(t),r=n.prefixes,o=r===void 0?"./":r,a=n.delimiter,i=a===void 0?"/#?":a,c=[],s=0,p=0,l="",u=f(function(v){if(p<e.length&&e[p].type===v)return e[p++].value},"tryConsume"),w=f(function(v){var h=u(v);if(h!==void 0)return h;var R=e[p],$=R.type,L=R.index;throw new TypeError("Unexpected ".concat($," at ").concat(L,", expected ").concat(v))},"mustConsume"),m=f(function(){for(var v="",h;h=u("CHAR")||u("ESCAPED_CHAR");)v+=h;return v},"consumeText"),P=f(function(v){for(var h=0,R=i;h<R.length;h++){var $=R[h];if(v.indexOf($)>-1)return!0}return!1},"isSafe"),x=f(function(v){var h=c[c.length-1],R=v||(h&&typeof h=="string"?h:"");if(h&&!R)throw new TypeError('Must have text between two parameters, missing text after "'.concat(h.name,'"'));return!R||P(R)?"[^".concat(T(i),"]+?"):"(?:(?!".concat(T(R),")[^").concat(T(i),"])+?")},"safePattern");p<e.length;){var E=u("CHAR"),g=u("NAME"),b=u("PATTERN");if(g||b){var y=E||"";o.indexOf(y)===-1&&(l+=y,y=""),l&&(c.push(l),l=""),c.push({name:g||s++,prefix:y,suffix:"",pattern:b||x(y),modifier:u("MODIFIER")||""});continue}var d=E||u("ESCAPED_CHAR");if(d){l+=d;continue}l&&(c.push(l),l="");var A=u("OPEN");if(A){var y=m(),_=u("NAME")||"",S=u("PATTERN")||"",C=m();w("CLOSE"),c.push({name:_||(S?s++:""),pattern:_&&!S?x(y):S,prefix:y,suffix:C,modifier:u("MODIFIER")||""});continue}w("END")}return c}f(z,"parse");function O(t,n){var e=[],r=F(t,e,n);return W(r,e,n)}f(O,"match");function W(t,n,e){e===void 0&&(e={});var r=e.decode,o=r===void 0?function(a){return a}:r;return function(a){var i=t.exec(a);if(!i)return!1;for(var c=i[0],s=i.index,p=Object.create(null),l=f(function(w){if(i[w]===void 0)return"continue";var m=n[w-1];m.modifier==="*"||m.modifier==="+"?p[m.name]=i[w].split(m.prefix+m.suffix).map(function(P){return o(P,m)}):p[m.name]=o(i[w],m)},"_loop_1"),u=1;u<i.length;u++)l(u);return{path:c,index:s,params:p}}}f(W,"regexpToFunction");function T(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}f(T,"escapeString");function D(t){return t&&t.sensitive?"":"i"}f(D,"flags");function K(t,n){if(!n)return t;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=e.exec(t.source);o;)n.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=e.exec(t.source);return t}f(K,"regexpToRegexp");function B(t,n,e){var r=t.map(function(o){return F(o,n,e).source});return new RegExp("(?:".concat(r.join("|"),")"),D(e))}f(B,"arrayToRegexp");function G(t,n,e){return J(z(t,e),n,e)}f(G,"stringToRegexp");function J(t,n,e){e===void 0&&(e={});for(var r=e.strict,o=r===void 0?!1:r,a=e.start,i=a===void 0?!0:a,c=e.end,s=c===void 0?!0:c,p=e.encode,l=p===void 0?function(h){return h}:p,u=e.delimiter,w=u===void 0?"/#?":u,m=e.endsWith,P=m===void 0?"":m,x="[".concat(T(P),"]|$"),E="[".concat(T(w),"]"),g=i?"^":"",b=0,y=t;b<y.length;b++){var d=y[b];if(typeof d=="string")g+=T(l(d));else{var A=T(l(d.prefix)),_=T(l(d.suffix));if(d.pattern)if(n&&n.push(d),A||_)if(d.modifier==="+"||d.modifier==="*"){var S=d.modifier==="*"?"?":"";g+="(?:".concat(A,"((?:").concat(d.pattern,")(?:").concat(_).concat(A,"(?:").concat(d.pattern,"))*)").concat(_,")").concat(S)}else g+="(?:".concat(A,"(").concat(d.pattern,")").concat(_,")").concat(d.modifier);else{if(d.modifier==="+"||d.modifier==="*")throw new TypeError('Can not repeat "'.concat(d.name,'" without a prefix and suffix'));g+="(".concat(d.pattern,")").concat(d.modifier)}else g+="(?:".concat(A).concat(_,")").concat(d.modifier)}}if(s)o||(g+="".concat(E,"?")),g+=e.endsWith?"(?=".concat(x,")"):"$";else{var C=t[t.length-1],v=typeof C=="string"?E.indexOf(C[C.length-1])>-1:C===void 0;o||(g+="(?:".concat(E,"(?=").concat(x,"))?")),v||(g+="(?=".concat(E,"|").concat(x,")"))}return new RegExp(g,D(e))}f(J,"tokensToRegexp");function F(t,n,e){return t instanceof RegExp?K(t,n):Array.isArray(t)?B(t,n,e):G(t,n,e)}f(F,"pathToRegexp");var q=/[.+?^${}()|[\]\\]/g;function*V(t){let n=new URL(t.url).pathname;for(let e of[...I].reverse()){if(e.method&&e.method!==t.method)continue;let r=O(e.routePath.replace(q,"\\$&"),{end:!1}),o=O(e.mountPath.replace(q,"\\$&"),{end:!1}),a=r(n),i=o(n);if(a&&i)for(let c of e.middlewares.flat())yield{handler:c,params:a.params,path:i.path}}for(let e of I){if(e.method&&e.method!==t.method)continue;let r=O(e.routePath.replace(q,"\\$&"),{end:!0}),o=O(e.mountPath.replace(q,"\\$&"),{end:!1}),a=r(n),i=o(n);if(a&&i&&e.modules.length){for(let c of e.modules.flat())yield{handler:c,params:a.params,path:a.path};break}}}f(V,"executeRequest");var ue={async fetch(t,n,e){let r=t,o=V(r),a={},i=!1,c=f(async(s,p)=>{if(s!==void 0){let u=s;typeof s=="string"&&(u=new URL(s,r.url).toString()),r=new Request(u,p)}let l=o.next();if(l.done===!1){let{handler:u,params:w,path:m}=l.value,P={request:new Request(r.clone()),functionPath:m,next:c,params:w,get data(){return a},set data(E){if(typeof E!="object"||E===null)throw new Error("context.data must be an object");a=E},env:n,waitUntil:e.waitUntil.bind(e),passThroughOnException:f(()=>{i=!0},"passThroughOnException")},x=await u(P);if(!(x instanceof Response))throw new Error("Your Pages function should return a Response");return M(x)}else{let u=await n.ASSETS.fetch(r);return M(u)}},"next");try{return await c()}catch(s){if(i){let p=await n.ASSETS.fetch(r);return M(p)}throw s}}},M=f(t=>new Response([101,204,205,304].includes(t.status)?null:t.body,t),"cloneResponse");export{ue as default};
